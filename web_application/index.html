<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Model Visualization Experiment</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600&family=Plus+Jakarta+Sans:wght@400;700&display=swap"
        rel="stylesheet">
</head>

<body>
    <div id="app">
        <header>
            <div class="logo">
                <span class="gradient-text">Experiment</span> Session
            </div>
            <div class="progress-wrapper hidden">
                <div class="progress-text">Question <span id="current-q">1</span> of <span id="total-q">20</span></div>
                <div class="progress-bar-container">
                    <div id="progress-bar" class="progress-bar"></div>
                </div>
            </div>
        </header>

        <main>
            <!-- DEMOGRAPHICS SECTION -->
            <section id="demographics-area" class="glass-panel">
                <h1 class="gradient-text">Welcome to the Experiment</h1>
                <p class="section-intro">Before we begin, please provide some information about yourself. All data is
                    anonymous and used only for research purposes.</p>

                <form id="demographics-form" class="demographics-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="age">Age Range</label>
                            <select id="age" required>
                                <option value="">Select...</option>
                                <option value="18-24">18-24</option>
                                <option value="25-34">25-34</option>
                                <option value="35-44">35-44</option>
                                <option value="45-54">45-54</option>
                                <option value="55-64">55-64</option>
                                <option value="65+">65+</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="gender">Gender</label>
                            <select id="gender" required>
                                <option value="">Select...</option>
                                <option value="male">Male</option>
                                <option value="female">Female</option>
                                <option value="non-binary">Non-binary</option>
                                <option value="prefer-not">Prefer not to say</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="education">Education Level</label>
                            <select id="education" required>
                                <option value="">Select...</option>
                                <option value="high-school">High School</option>
                                <option value="bachelors">Bachelor's Degree</option>
                                <option value="masters">Master's Degree</option>
                                <option value="phd">PhD / Doctorate</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="country">Country of Residence</label>
                            <input type="text" id="country" placeholder="e.g., France" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group full-width" style="align-items: center;">
                            <label for="ai-expertise">AI/ML Expertise (1=None, 7=Expert)</label>
                            <div class="range-container"
                                style="display: flex; align-items: center; gap: 10px; width: 100%; max-width: 400px;">
                                <span>1</span>
                                <input type="range" id="ai-expertise" min="1" max="7" value="4" style="flex: 1;">
                                <span>7</span>
                            </div>
                            <div style="text-align: center; font-size: 0.9rem; margin-top: 5px;">
                                Current: <span id="ai-expertise-val">4</span>
                            </div>
                        </div>
                    </div>

                    <button type="submit" class="primary-btn">Continue</button>
                </form>
            </section>

            <!-- TRAINING SECTION -->
            <section id="training-area" class="glass-panel hidden">
                <div class="training-header">
                    <h1 class="gradient-text">Understanding Heatmaps</h1>
                    <div class="step-indicator">
                        <span class="step active" data-step="1">1</span>
                        <span class="step" data-step="2">2</span>
                        <span class="step" data-step="3">3</span>
                    </div>
                </div>

                <!-- Training Step 1: XAI Introduction -->
                <div class="training-step" id="training-step-1">
                    <h2>What is Explainable AI?</h2>
                    <div class="training-content">
                        <p>When an AI system makes a decision, such as recognizing an object in a photo, it doesn‚Äôt
                            usually explain how the decision is made. Explainable AI (XAI) aims to provide methods that
                            help humans understand how and why a model reaches a particular decision. One common
                            approach is to create visual explanations that highlight which parts of the image the model
                            focused on when making its choice.</p>

                        <div class="info-box">
                            <h3>üîç Heatmaps</h3>
                            <p>In Explainable AI, a common way to highlight which parts of an image the AI model
                                considers most important for its decision is the <strong>Heatmap</strong>. Heatmap uses
                                a spectrum of colors (from cold blue to warm red) to highlight the importance of the
                                area in the image for the decision.</p>
                        </div>

                        <div class="colormap-legend">
                            <h3>The Jet Colormap</h3>
                            <div class="colormap-bar"></div>
                            <div class="colormap-labels">
                                <span>Low importance</span>
                                <span>Medium</span>
                                <span>High importance</span>
                            </div>
                            <p class="colormap-description">
                                <strong>Blue</strong> = Low attention (cold) ‚Üí
                                <strong>Green/Yellow</strong> = Medium attention ‚Üí
                                <strong>Red</strong> = High attention (hot)
                            </p>
                        </div>
                    </div>
                    <button class="primary-btn" onclick="nextTrainingStep()">Next: See an Example</button>
                </div>

                <!-- Training Step 2: Example with Explanation -->
                <div class="training-step hidden" id="training-step-2">
                    <h2>Example: Understanding a Heatmap</h2>
                    <div class="training-content">
                        <div class="example-comparison">
                            <div class="example-card">
                                <div class="badge">Original Image</div>
                                <img id="example-original" src="data/2007_001763/Target_1/original.png"
                                    alt="Example Original">
                                <p class="example-caption">An image containing a cat and a dog</p>
                            </div>
                            <div class="example-card">
                                <div class="badge heatmap-badge">Heatmap for "Cat"</div>
                                <img id="example-heatmap" src="data/2007_001763/Target_1/legrad_omp.png"
                                    alt="Example Heatmap">
                                <p class="example-caption">The model highlights the <strong>cat</strong> (red/orange
                                    areas)</p>
                            </div>
                        </div>

                        <div class="explanation-box">
                            <p>In this example, when asked about <strong>"Cat"</strong>, the heatmap shows warm colors
                                (red/orange) concentrated on the cat. This means the model is correctly focusing on the
                                cat region to identify it.</p>
                        </div>
                    </div>
                    <button class="primary-btn" onclick="nextTrainingStep()">Next: Practice Question</button>
                </div>

                <!-- Training Step 3: Practice Question -->
                <div class="training-step hidden" id="training-step-3">
                    <h2>Practice: Can You Read the Heatmap?</h2>
                    <div class="training-content">
                        <div class="example-comparison">
                            <div class="example-card">
                                <div class="badge">Original Image</div>
                                <img src="data/2007_001763/Target_2/original.png" alt="Practice Original">
                            </div>
                            <div class="example-card">
                                <div class="badge heatmap-badge">Generated Heatmap</div>
                                <img src="data/2007_001763/Target_2/legrad_omp.png" alt="Practice Heatmap">
                            </div>
                        </div>

                        <div class="practice-question">
                            <p><strong>Question:</strong> Based on the heatmap, which class is the model focusing on?
                            </p>
                            <div class="practice-options">
                                <button class="option-btn practice-opt" data-correct="false"
                                    onclick="checkPractice(this)">Cat</button>
                                <button class="option-btn practice-opt" data-correct="true"
                                    onclick="checkPractice(this)">Dog</button>
                                <button class="option-btn practice-opt" data-correct="false"
                                    onclick="checkPractice(this)">Neither</button>
                            </div>
                            <div id="practice-feedback" class="hidden">
                                <p class="practice-result"></p>
                            </div>
                        </div>
                    </div>
                    <button class="primary-btn hidden" id="start-experiment-btn" onclick="startMainExperiment()">Begin
                        the Experiment</button>
                </div>
            </section>

            <section id="experiment-area" class="glass-panel hidden">
                <div class="image-comparison">
                    <div class="image-card">
                        <div class="badge">Original Image</div>
                        <img id="original-img" src="" alt="Original Image">
                    </div>
                    <div class="image-card">
                        <div class="badge heatmap-badge" id="method-label">Generated Heatmap</div>
                        <img id="heatmap-img" src="" alt="Model Heatmap">
                    </div>
                </div>

                <div class="interaction-area">
                    <h2 id="question-text">What element do you think the heatmap is highlighting in the image? (Red
                        areas of the heatmap)</h2>

                    <div id="options-container" class="options-grid">
                        <!-- Options will be injected here -->
                    </div>

                    <div id="feedback-area" class="hidden">
                        <!-- Final result shown after confirmation -->
                        <div id="result-section" class="hidden">
                            <div id="feedback-message" class="feedback-message"></div>
                        </div>

                        <div id="clarity-survey" class="hidden">
                            <div class="clarity-explanation">
                                <p><strong>Rate the clarity of this heatmap:</strong></p>
                                <p class="clarity-note">If you found it difficult to identify the target, it may be
                                    because the visualization method wasn't clear enough ‚Äî not your fault!</p>
                            </div>
                            <div class="clarity-scale">
                                <div class="clarity-option" data-value="1">
                                    <span class="clarity-number">1</span>
                                    <span class="clarity-label">Very unclear</span>
                                </div>
                                <div class="clarity-option" data-value="2">
                                    <span class="clarity-number">2</span>
                                    <span class="clarity-label">Unclear</span>
                                </div>
                                <div class="clarity-option" data-value="3">
                                    <span class="clarity-number">3</span>
                                    <span class="clarity-label">Neutral</span>
                                </div>
                                <div class="clarity-option" data-value="4">
                                    <span class="clarity-number">4</span>
                                    <span class="clarity-label">Clear</span>
                                </div>
                                <div class="clarity-option" data-value="5">
                                    <span class="clarity-number">5</span>
                                    <span class="clarity-label">Very clear</span>
                                </div>
                            </div>
                        </div>
                        <button id="next-btn" class="primary-btn hidden">Next Question</button>
                    </div>
                </div>
            </section>

            <section id="completion-area" class="glass-panel hidden">
                <h1 class="gradient-text">Experiment Completed</h1>
                <p>Thank you for participating!</p>

                <div id="feedback-form-container">
                    <div class="form-group full-width" style="margin-bottom: 2rem;">
                        <label style="display: block; margin-bottom: 1rem; font-size: 1.1rem;">How would you rate the
                            difficulty of the tasks? (1: Difficult, 5: Easy)</label>
                        <div class="clarity-scale" id="difficulty-scale">
                            <div class="clarity-option feedback-opt" data-type="difficulty" data-value="1">
                                <span class="clarity-number">1</span>
                                <span class="clarity-label">Difficult</span>
                            </div>
                            <div class="clarity-option feedback-opt" data-type="difficulty" data-value="2">
                                <span class="clarity-number">2</span>
                            </div>
                            <div class="clarity-option feedback-opt" data-type="difficulty" data-value="3">
                                <span class="clarity-number">3</span>
                                <span class="clarity-label">Neutral</span>
                            </div>
                            <div class="clarity-option feedback-opt" data-type="difficulty" data-value="4">
                                <span class="clarity-number">4</span>
                            </div>
                            <div class="clarity-option feedback-opt" data-type="difficulty" data-value="5">
                                <span class="clarity-number">5</span>
                                <span class="clarity-label">Easy</span>
                            </div>
                        </div>
                    </div>

                    <div class="form-group full-width" style="margin-bottom: 2rem;">
                        <label style="display: block; margin-bottom: 1rem; font-size: 1.1rem;">How would you rate the
                            consistency of the heatmaps across images? (1: Inconsistent, 5: Consistent)</label>
                        <div class="clarity-scale" id="consistency-scale">
                            <div class="clarity-option feedback-opt" data-type="consistency" data-value="1">
                                <span class="clarity-number">1</span>
                                <span class="clarity-label">Inconsistent</span>
                            </div>
                            <div class="clarity-option feedback-opt" data-type="consistency" data-value="2">
                                <span class="clarity-number">2</span>
                            </div>
                            <div class="clarity-option feedback-opt" data-type="consistency" data-value="3">
                                <span class="clarity-number">3</span>
                                <span class="clarity-label">Neutral</span>
                            </div>
                            <div class="clarity-option feedback-opt" data-type="consistency" data-value="4">
                                <span class="clarity-number">4</span>
                            </div>
                            <div class="clarity-option feedback-opt" data-type="consistency" data-value="5">
                                <span class="clarity-number">5</span>
                                <span class="clarity-label">Consistent</span>
                            </div>
                        </div>
                    </div>

                    <div style="text-align: center;">
                        <button id="finish-experiment-btn" class="primary-btn" onclick="submitFeedback()">Finish
                            Experiment</button>
                    </div>
                </div>

                <div id="final-thank-you" class="hidden" style="text-align: center; margin-top: 2rem;">
                    <h2 class="gradient-text">Thank You!</h2>
                    <p>Your responses have been saved.</p>
                </div>

            </section>
        </main>

        <footer>

        </footer>
    </div>
    <!-- Firebase SDK (Compat) -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <script src="firebase_config.js"></script>

    <script src="data.js"></script>
    <script src="main.js"></script>
</body>

</html>